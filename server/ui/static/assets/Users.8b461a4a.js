import{o,c as r,a as e,d as ae,b as oe,i as ne,J as le,u as re,l as g,E as ie,m as de,p as ce,t as i,k as t,n as B,q as C,s as m,v as x,x as P,F as v,j as y,f as z,w as $,K as q,g as ue,G as pe}from"./index.830687ec.js";import{P as D,r as _e}from"./pagination.c342ed01.js";import{r as R}from"./TrashIcon.06f69860.js";import{N as me,o as Z,_ as xe,U as he,f as ve}from"./transition.8310a638.js";import"./use-outside-click.193601c7.js";function H(F,a){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})])}function fe(F,a){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})])}function we(F,a){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z"})])}const be={class:"lg:-mt-px bg-context-50 dark:bg-context-900 shadow dark:shadow-context-500"},ke={class:"px-4 sm:px-6 lg:mx-auto lg:max-w-6xl lg:px-8"},ye={class:"py-6 flex items-center justify-between"},ge={class:"ml-3 text-xl md:text-2xl font-bold leading-7 text-context-900 dark:text-context-100 truncate sm:leading-9"},Ce=["onClick"],je={class:"hidden md:inline"},Pe={class:"mt-8"},$e={key:0,class:""},Te={class:"ml-3 text-lg md:text-xl text-center text-context-900 dark:text-context-100 select-none"},Ue={role:"list",class:"mt-2 divide-y divide-context-200 overflow-hidden shadow dark:shadow-context-500"},Me={class:"block bg-context-50 dark:bg-context-800 px-4 py-4 hover:bg-context-50"},Ve={class:"flex items-center space-x-4"},qe={class:"flex flex-1 space-x-2 truncate"},Ee={class:"flex flex-col truncate text-sm text-context-500 dark:text-context-400"},Le={key:0,class:"truncate"},Be={class:"font-medium text-context-900 dark:text-context-100 mr-2"},Fe={class:"space-y-2"},Ne=["onClick"],ze=["onClick"],De={class:"flex items-center justify-between border-t border-context-200 bg-context-50 dark:bg-context-800 px-4 py-3","aria-label":"Pagination"},Re={class:"flex flex-1 justify-between"},Se=["disabled"],Oe=["disabled"],Ie={key:1,class:"hidden md:block"},Ge={class:"mt-2 flex flex-col"},Ae={class:"min-w-full overflow-hidden overflow-x-auto align-middle shadow md:rounded-lg"},Je={class:"min-w-full divide-y divide-context-200"},Ke={class:"bg-context-50 dark:bg-context-700 px-6 py-3 text-left text-sm font-semibold text-context-900 dark:text-context-100",scope:"col"},Qe={class:"bg-context-50 dark:bg-context-700 px-6 py-3 text-sm font-semibold text-context-900 dark:text-context-100 text-right",scope:"col"},We={class:"divide-y divide-context-200 bg-context-50 dark:bg-context-800"},Xe={class:"max-w-[12rem] whitespace-nowrap px-6 py-4 text-sm text-context-900 dark:text-context-100"},Ye={class:"truncate"},Ze={class:"whitespace-nowrap px-6 py-4 text-sm text-right flex justify-end space-x-1"},He=["onClick"],et=["onClick"],tt={class:"flex items-center justify-between border-t border-context-200 bg-context-50 dark:bg-context-800 px-4 py-3 sm:px-6","aria-label":"Pagination"},st={class:"hidden sm:block"},at=["innerHTML"],ot={class:"flex flex-1 justify-between sm:justify-end"},nt=["disabled"],lt=["disabled"],rt=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),it={class:"fixed inset-0 z-10 overflow-y-auto"},dt={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},ct=["onSubmit"],ut={class:"text-center sm:mt-5"},pt={class:"block mt-6 text-left text-context-900 dark:text-context-100"},_t={class:"space-y-6"},mt={key:0},xt={for:"new_username",class:"form-label"},ht={class:"mt-1 flex"},vt=["required","placeholder"],ft={for:"hub_password",class:"form-label"},wt={class:"mt-1 flex"},bt=["required","placeholder"],kt={class:"form-hint"},yt={for:"smtp_password",class:"form-label"},gt={class:"mt-1 flex"},Ct=["placeholder"],jt={class:"form-hint"},Pt={class:"flex justify-between"},$t={for:"smtp_auth_ips",class:"form-label"},Tt={class:"mt-1 flex flex-col -space-y-px"},Ut=["id","onUpdate:modelValue","placeholder"],Mt=["onClick"],Vt={class:"mt-6 sm:mt-8 flex items-center justify-between"},qt=["onClick"],Et={type:"submit",class:"btn btn--primary"},Lt={for:"search-field",class:"sr-only"},Bt={class:"relative w-full text-context-400 focus-within:text-context-600"},Ft={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center","aria-hidden":"true"},Nt=["placeholder"],It=ae({__name:"Users",setup(F){const{t:a}=oe(),d=ne("MailHedgehog");le();const ee=re(),T=g({page:1,per_page:25,search:""}),S=g(!1),w=g(!1),E=g([]),u=g(new D),j=(c=null)=>{w.value=!0,c&&(T.value.page=c),d==null||d.request().get("users",{params:T.value}).then(s=>{var b,l,f,M,V,h,_,k,G,A,J,K,Q,W,X,Y;(b=s.data)!=null&&b.data?E.value=(l=s.data)==null?void 0:l.data:E.value=[],(M=(f=s.data)==null?void 0:f.meta)!=null&&M.pagination?u.value=new D((h=(V=s.data)==null?void 0:V.meta)==null?void 0:h.pagination.current_page,(k=(_=s.data)==null?void 0:_.meta)==null?void 0:k.pagination.per_page,(A=(G=s.data)==null?void 0:G.meta)==null?void 0:A.pagination.last_page,(K=(J=s.data)==null?void 0:J.meta)==null?void 0:K.pagination.from,(W=(Q=s.data)==null?void 0:Q.meta)==null?void 0:W.pagination.to,(Y=(X=s.data)==null?void 0:X.meta)==null?void 0:Y.pagination.total):u.value=new D}).finally(()=>{w.value=!1})};let L=null;ie(()=>T.value.search,()=>{L&&(clearTimeout(L),L=null),L=setTimeout(()=>{j(1)},500)},{deep:!0}),de(()=>{j(1),S.value=!0});const U=(c="next")=>{j(u.value.getPageFromDirection(c))},p=g(null),n=g({new_username:null,dashboard_password:null,smtp_password:null,smtp_auth_ips:[],smtp_allow_listed_ips:[],dashboard_auth_emails:[]}),O=c=>{n.value.smtp_auth_ips=c.smtp_auth_ips,n.value.smtp_allow_listed_ips=c.smtp_allow_listed_ips,n.value.dashboard_auth_emails=c.dashboard_auth_emails,p.value=c},te=()=>{p.value={username:"",smtp_auth_ips:[],smtp_allow_listed_ips:[],dashboard_auth_emails:[]}},se=()=>{var b;w.value=!0;const c=d==null?void 0:d.request();let s;(b=p.value)!=null&&b.username?s=c==null?void 0:c.put(`users/${p.value.username}`,{dashboard_password:n.value.dashboard_password,smtp_password:n.value.smtp_password,smtp_auth_ips:n.value.smtp_auth_ips,smtp_allow_listed_ips:n.value.smtp_allow_listed_ips,dashboard_auth_emails:n.value.dashboard_auth_emails}):s=c==null?void 0:c.post("users",{username:n.value.new_username,dashboard_password:n.value.dashboard_password,smtp_password:n.value.smtp_password,smtp_auth_ips:n.value.smtp_auth_ips,smtp_allow_listed_ips:n.value.smtp_allow_listed_ips,dashboard_auth_emails:n.value.dashboard_auth_emails}),s==null||s.then(l=>{var f;j(),(f=p.value)!=null&&f.username?d==null||d.success(a("users.updated")):d==null||d.success(a("users.created")),N()}).catch(l=>{d==null||d.onResponseError(l,"Response Error")}).finally(()=>{w.value=!1})},N=()=>{p.value=null,n.value={new_username:null,dashboard_password:null,smtp_password:null,smtp_auth_ips:[],smtp_allow_listed_ips:[],dashboard_auth_emails:[]}},I=c=>{ee.dispatch("confirmDialog/confirm").then(()=>{w.value=!0,d==null||d.request().delete(`users/${c.username}`).then(()=>{u.value.count()===0?U("prev"):j(),d==null||d.success(a("users.deleted"))}).catch(s=>{d.onResponseError(s,"Response Error")}).catch(()=>{w.value=!1})})};return(c,s)=>{const b=ce("tooltip");return o(),r(v,null,[e("div",be,[e("div",ke,[e("div",ye,[e("h1",ge,i(t(a)("users.pageTitle")),1),e("div",{class:B(["flex justify-end ml-4 transition-all duration-200",{"pointer-events-none opacity-75":w.value}])},[u.value&&!u.value.isEmpty()?C((o(),r("button",{key:0,type:"button",class:"btn btn--default whitespace-nowrap",onClick:m(te,["prevent"])},[x(t(we),{class:"w-4 h-4 md:mr-2"}),e("span",je,i(t(a)("users.create")),1)],8,Ce)),[[b,t(a)("users.create")]]):P("",!0)],2)])])]),e("div",Pe,[u.value.isEmpty()?(o(),r("div",$e,[e("h3",Te,[w.value?(o(),r(v,{key:0},[y(i(t(a)("pagination.requesting")),1)],64)):(o(),r(v,{key:1},[y(i(t(a)("users.empty")),1)],64))])])):(o(),r(v,{key:1},[u.value?(o(),r("div",{key:0,class:B(["shadow dark:shadow-context-500 md:hidden",{"pointer-events-none opacity-75":w.value}])},[e("ul",Ue,[(o(!0),r(v,null,z(E.value,l=>(o(),r("li",{key:l.username},[e("div",Me,[e("span",Ve,[e("span",qe,[e("span",Ee,[l.username?(o(),r("span",Le,[e("span",Be,i(t(a)("users.username")),1),y(" "+i(l.username),1)])):P("",!0)])]),e("div",Fe,[e("a",{class:"cursor-pointer block transition-all duration-500 text-context-500 dark:text-context-400 hover:text-context-700 hover:dark:text-context-300",onClick:m(f=>O(l),["prevent"])},[x(t(H),{class:"h-5 w-5 flex-shrink-0","aria-hidden":"true"})],8,Ne),e("a",{class:"cursor-pointer block transition-all duration-500 text-context-500 dark:text-context-400 hover:text-context-700 hover:dark:text-context-300",onClick:m(f=>I(l),["prevent"])},[x(t(R),{class:"h-5 w-5 flex-shrink-0","aria-hidden":"true"})],8,ze)])])])]))),128))]),e("nav",De,[e("div",Re,[e("button",{disabled:u.value.isOnFirst(),class:"btn btn--default",onClick:s[0]||(s[0]=m(l=>U("prev"),["prevent"]))},i(t(a)("pagination.prev")),9,Se),e("button",{disabled:u.value.isOnLast(),class:"ml-3 btn btn--default",onClick:s[1]||(s[1]=m(l=>U("next"),["prevent"]))},i(t(a)("pagination.next")),9,Oe)])])],2)):P("",!0),u.value?(o(),r("div",Ie,[e("div",{class:B(["mx-auto max-w-6xl px-4 md:px-6 lg:px-8 transition-all duration-200",{"pointer-events-none opacity-75":w.value}])},[e("div",Ge,[e("div",Ae,[e("table",Je,[e("thead",null,[e("tr",null,[e("th",Ke,i(t(a)("users.username")),1),e("th",Qe,i(t(a)("pagination.actions")),1)])]),e("tbody",We,[(o(!0),r(v,null,z(E.value,l=>(o(),r("tr",{key:l.username,class:"bg-context-50 dark:bg-context-800"},[e("td",Xe,[e("div",Ye,i(l.username),1)]),e("td",Ze,[e("a",{class:"cursor-pointer transition-all duration-500 text-context-500 dark:text-context-400 hover:text-context-700 hover:dark:text-context-300",onClick:m(f=>O(l),["prevent"])},[x(t(H),{class:"w-5 h-5","aria-hidden":"true"})],8,He),e("a",{class:"cursor-pointer transition-all duration-500 text-context-500 dark:text-context-400 hover:text-context-700 hover:dark:text-context-300",onClick:m(f=>I(l),["prevent"])},[x(t(R),{class:"w-5 h-5","aria-hidden":"true"})],8,et)])]))),128))])]),e("nav",tt,[e("div",st,[e("p",{class:"text-sm text-context-700 dark:text-context-200",innerHTML:t(a)("pagination.text",{from:u.value.getFrom(),to:u.value.getTo(),of:u.value.getTotal()})},null,8,at)]),e("div",ot,[e("button",{disabled:u.value.isOnFirst(),class:"btn btn--default",onClick:s[2]||(s[2]=m(l=>U("prev"),["prevent"]))},i(t(a)("pagination.prev")),9,nt),e("button",{disabled:u.value.isOnLast(),class:"ml-3 btn btn--default",onClick:s[3]||(s[3]=m(l=>U("next"),["prevent"]))},i(t(a)("pagination.next")),9,lt)])])])])],2)])):P("",!0)],64))]),x(t(ve),{as:"template",show:p.value!==null},{default:$(()=>[x(t(me),{as:"div",class:B(["relative z-10",{"pointer-events-none":w.value}]),onClose:N},{default:$(()=>[x(t(Z),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:$(()=>[rt]),_:1}),e("div",it,[e("div",dt,[x(t(Z),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:$(()=>[x(t(xe),{class:"bg-context-50 dark:bg-context-900 relative transform overflow-hidden rounded-lg px-4 pt-5 pb-4 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6"},{default:$(()=>{var l,f,M,V;return[e("form",{onSubmit:m(se,["prevent"])},[e("div",null,[e("div",ut,[x(t(he),{as:"h3",class:"text-lg font-medium leading-6 text-context-900 dark:text-context-100"},{default:$(()=>{var h,_;return[((h=p.value)==null?void 0:h.username)===""?(o(),r(v,{key:0},[y(i(t(a)("users.modal.createTitle")),1)],64)):(o(),r(v,{key:1},[y(i(t(a)("users.modal.editTitle",{user:(_=p.value)==null?void 0:_.username})),1)],64))]}),_:1}),e("div",pt,[e("div",_t,[((l=p.value)==null?void 0:l.username)===""?(o(),r("div",mt,[e("label",xt,i(t(a)("users.username")),1),e("div",ht,[C(e("input",{id:"new_username","onUpdate:modelValue":s[4]||(s[4]=h=>n.value.new_username=h),name:"new_username",type:"text",autocomplete:"off",required:p.value.username==="",class:"form-input",placeholder:t(a)("users.username")},null,8,vt),[[q,n.value.new_username]])])])):P("",!0),e("div",null,[e("label",ft,i(t(a)("users.hubPassword")),1),e("div",wt,[C(e("input",{id:"hub_password","onUpdate:modelValue":s[5]||(s[5]=h=>n.value.dashboard_password=h),name:"hub_password",type:"password",autocomplete:"hub_password",required:((f=p.value)==null?void 0:f.username)==="",class:"form-input",placeholder:t(a)("users.hubPassword")},null,8,bt),[[q,n.value.dashboard_password]])]),e("div",kt,[((M=p.value)==null?void 0:M.username)===""?(o(),r(v,{key:0},[],64)):(o(),r(v,{key:1},[y(i(t(a)("users.emptyPasswordHint")),1)],64))])]),e("div",null,[e("label",yt,i(t(a)("users.smtpPassword")),1),e("div",gt,[C(e("input",{id:"smtp_password","onUpdate:modelValue":s[6]||(s[6]=h=>n.value.smtp_password=h),name:"smtp_password",type:"password",autocomplete:"smtp_password",class:"form-input",placeholder:t(a)("users.smtpPassword")},null,8,Ct),[[q,n.value.smtp_password]])]),e("div",jt,[((V=p.value)==null?void 0:V.username)===""?(o(),r(v,{key:0},[y(i(t(a)("users.emptySmtpPasswordHint")),1)],64)):(o(),r(v,{key:1},[y(i(t(a)("users.emptyPasswordHint")),1)],64))])]),e("div",null,[e("div",Pt,[e("label",$t,i(t(a)("users.smtpNoPassIps")),1),C((o(),r("a",{class:"cursor-pointer transition-all duration-500 text-context-500 dark:text-context-400 hover:text-primary-500 hover:dark:text-primary-500 flex justify-center items-center w-auto px-3",onClick:s[7]||(s[7]=m(h=>{var _,k;return(k=(_=n.value)==null?void 0:_.smtp_auth_ips)==null?void 0:k.push("127.0.0.1")},["prevent"]))},[x(t(fe),{class:"h-5 w-5 flex-shrink-0","aria-hidden":"true"})])),[[b,t(a)("users.addIPHint")]])]),e("div",Tt,[(o(!0),r(v,null,z(n.value.smtp_auth_ips,(h,_)=>(o(),r("div",{key:_,class:"flex form-inputs-list-item"},[C(e("input",{id:`smtp_auth_ips_${_}`,"onUpdate:modelValue":k=>n.value.smtp_auth_ips[_]=k,name:"smtp_auth_ips[]",type:"text",autocomplete:"off",class:"form-input",placeholder:t(a)("users.ipPlaceholder"),maxlength:"39",required:""},null,8,Ut),[[q,n.value.smtp_auth_ips[_]]]),e("a",{class:"cursor-pointer transition-all duration-500 text-context-500 dark:text-context-400 hover:text-context-700 hover:dark:text-context-300 flex justify-center items-center form-input w-auto border-l-0",onClick:m(k=>n.value.smtp_auth_ips.splice(_,1),["prevent"])},[x(t(R),{class:"h-5 w-5 flex-shrink-0","aria-hidden":"true"})],8,Mt)]))),128))])])])])])]),e("div",Vt,[e("button",{type:"button",class:"btn btn--default",onClick:m(N,["prevent"])},i(t(a)("users.modal.cancel")),9,qt),e("button",Et,i(t(a)("users.modal.submit")),1)])],40,ct)]}),_:1})]),_:1})])])]),_:1},8,["class"])]),_:1},8,["show"]),S.value?(o(),ue(pe,{key:0,to:"#header-search"},[e("form",{class:"flex w-full md:ml-0",method:"GET",onSubmit:s[9]||(s[9]=m(l=>j(1),["prevent"]))},[e("label",Lt,i(t(a)("inbox.search")),1),e("div",Bt,[e("div",Ft,[x(t(_e),{class:"h-5 w-5","aria-hidden":"true"})]),C(e("input",{id:"search-field","onUpdate:modelValue":s[8]||(s[8]=l=>T.value.search=l),name:"search-field",class:"block h-full w-full py-2 pl-8 pr-3 sm:text-sm focus:outline-none focus:ring-0 border-transparent focus:border-transparent placeholder-context-500 bg-context-50 dark:bg-context-900 text-context-900 dark:text-context-100",placeholder:t(a)("users.search"),type:"search"},null,8,Nt),[[q,T.value.search]])])],32)])):P("",!0)],64)}}});export{It as default};
